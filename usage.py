from dash.dependencies import Input, Output, State
from dash import html, Dash, callback_context, clientside_callback, no_update, dcc

from dash_annotator import HTMLAnnotator, PDFAnnotator, TextAnnotator, DashAnnotator

import random
import base64
import json
#with open('../annotator/src/annotator/assets/documents/construction.pdf', 'rb') as f:
with open('C:/Users/Riley/Downloads/example_pdf.pdf', 'rb') as f:
    pdf_data = base64.b64encode(f.read()).decode()
    pdf_data = f'data:application/pdf;base64,{pdf_data}'
with open('sample_html_file.html', 'r', encoding='utf-8') as f:
    html_data = f.read()
text_data = """
This is the first line
I'm typing some more stuff on the second line.
On to the third line!
What do you think about the fourth line?
And lastly, the fifth line...
""".strip()
pdf_highlights = json.loads('[{"id":"lbub1g2m26a8wdo28","text":"Provide training in a form that is readilyunderstandable by all employees on the followingtopics:","position":{"page":1,"rects":[{"left":0.04901960784313726,"top":0.40261275551535874,"width":0.31044520957797184,"height":0.015151515151515154,"page":1},{"left":0.04901960784313726,"top":0.4186036427815756,"width":0.36843061260148596,"height":0.015840218283913354,"page":1},{"left":0.04901960784313726,"top":0.4186036427815756,"width":0.36843061260148596,"height":0.015151515151515154,"page":1},{"left":0.41766931870404417,"top":0.4186036427815756,"width":0.023888472014782478,"height":0.015840218283913354,"page":1},{"left":0.41766931870404417,"top":0.4186036427815756,"width":0.023888472014782478,"height":0.015151515151515154,"page":1},{"left":0.04901960784313726,"top":0.4345837564179392,"width":0.051963716394761036,"height":0.015151515151515154,"page":1}]},"color":"orange"},{"id":"lbub16p42zciy2ft0","text":"NOTE: Hand sanitizers must have at least 60% alcohol.They are less effective than hand-washing in preventingthe spread of COVID-19 but can be used as an interimmeasure if a hand-washing station is not immediatelyavailable.","position":{"page":1,"rects":[{"left":0.5049297856349572,"top":0.46533874742912534,"width":0.44235845827588854,"height":0.015151526711203837,"page":1},{"left":0.5049297856349572,"top":0.4812543002041904,"width":0.26460379806219364,"height":0.015840218283913354,"page":1},{"left":0.5049297856349572,"top":0.4812543002041904,"width":0.26460379806219364,"height":0.015151515151515154,"page":1},{"left":0.7697610294117648,"top":0.4812543002041904,"width":0.005974264705882353,"height":0.015840218283913354,"page":1},{"left":0.7697610294117648,"top":0.4812543002041904,"width":0.005974264705882353,"height":0.015151515151515154,"page":1},{"left":0.7757491766237746,"top":0.4812543002041904,"width":0.17365926106770835,"height":0.015840218283913354,"page":1},{"left":0.7757491766237746,"top":0.4812543002041904,"width":0.17365926106770835,"height":0.015151515151515154,"page":1},{"left":0.5049297856349572,"top":0.49723441384055406,"width":0.1486627316942402,"height":0.015840218283913354,"page":1},{"left":0.5049297856349572,"top":0.49723441384055406,"width":0.1486627316942402,"height":0.015151515151515154,"page":1},{"left":0.6536876005284927,"top":0.49723441384055406,"width":0.01795809876685049,"height":0.015840218283913354,"page":1},{"left":0.6536876005284927,"top":0.49723441384055406,"width":0.01795809876685049,"height":0.015151515151515154,"page":1},{"left":0.6717218137254902,"top":0.49723441384055406,"width":0.005974264705882353,"height":0.015840218283913354,"page":1},{"left":0.6717218137254902,"top":0.49723441384055406,"width":0.005974264705882353,"height":0.015151515151515154,"page":1},{"left":0.6777099609375,"top":0.49723441384055406,"width":0.26085013595281864,"height":0.015840218283913354,"page":1},{"left":0.6777099609375,"top":0.49723441384055406,"width":0.26085013595281864,"height":0.015151515151515154,"page":1},{"left":0.5049297856349572,"top":0.5132252779873936,"width":0.14376657523360908,"height":0.015840218283913354,"page":1},{"left":0.5049297856349572,"top":0.5132252779873936,"width":0.14376657523360908,"height":0.015151515151515154,"page":1},{"left":0.6488831164790135,"top":0.5132252779873936,"width":0.005974264705882353,"height":0.015840218283913354,"page":1},{"left":0.6488831164790135,"top":0.5132252779873936,"width":0.005974264705882353,"height":0.015151515151515154,"page":1},{"left":0.6548573811848959,"top":0.5132252779873936,"width":0.2725580552045037,"height":0.015840218283913354,"page":1},{"left":0.6548573811848959,"top":0.5132252779873936,"width":0.2725580552045037,"height":0.015151515151515154,"page":1},{"left":0.5049297856349572,"top":0.5292376893939394,"width":0.07591516831341913,"height":0.015151515151515154,"page":1}]},"color":"cyan"},{"id":"lbub0z2gh8ovuj4n","text":" It containsinformation for construction employers on ways toupdate their IIPPs to include information on employeetraining and preventing the spread of coronavirus(SARS-CoV-2), the virus that causes COVID-19, atconstruction sites.","position":{"page":1,"rects":[{"left":0.31753534055223653,"top":0.24580320300477929,"width":0.08685096291934744,"height":0.015151515151515154,"page":1},{"left":0.04901960784313726,"top":0.2617833166411429,"width":0.39526887781479786,"height":0.015840218283913354,"page":1},{"left":0.04901960784313726,"top":0.2617833166411429,"width":0.39526887781479786,"height":0.015151515151515154,"page":1},{"left":0.04901960784313726,"top":0.27776343027750655,"width":0.4265460145239737,"height":0.015840218283913354,"page":1},{"left":0.04901960784313726,"top":0.27776343027750655,"width":0.4265460145239737,"height":0.015151515151515154,"page":1},{"left":0.04901960784313726,"top":0.29367897149288297,"width":0.39036724614162077,"height":0.015840218283913354,"page":1},{"left":0.04901960784313726,"top":0.29367897149288297,"width":0.39036724614162077,"height":0.015151515151515154,"page":1},{"left":0.04901960784313726,"top":0.3096590851292466,"width":0.05483736524394915,"height":0.015840218283913354,"page":1},{"left":0.04901960784313726,"top":0.3096590851292466,"width":0.05483736524394915,"height":0.015151515151515154,"page":1},{"left":0.10381851196289063,"top":0.3096590851292466,"width":0.005974264705882353,"height":0.015840218283913354,"page":1},{"left":0.10381851196289063,"top":0.3096590851292466,"width":0.005974264705882353,"height":0.015151515151515154,"page":1},{"left":0.10989025340360754,"top":0.3096590851292466,"width":0.03489644667681526,"height":0.015840218283913354,"page":1},{"left":0.10989025340360754,"top":0.3096590851292466,"width":0.03489644667681526,"height":0.015151515151515154,"page":1},{"left":0.1449002883013557,"top":0.3096590851292466,"width":0.005974264705882353,"height":0.015840218283913354,"page":1},{"left":0.1449002883013557,"top":0.3096590851292466,"width":0.005974264705882353,"height":0.015151515151515154,"page":1},{"left":0.15087455300723807,"top":0.3096590851292466,"width":0.09379659914502912,"height":0.015840218283913354,"page":1},{"left":0.15087455300723807,"top":0.3096590851292466,"width":0.09379659914502912,"height":0.015151515151515154,"page":1},{"left":0.2446663351619945,"top":0.3096590851292466,"width":0.005161270440793506,"height":0.015840218283913354,"page":1},{"left":0.2446663351619945,"top":0.3096590851292466,"width":0.005161270440793506,"height":0.015151515151515154,"page":1},{"left":0.2498328713809743,"top":0.3096590851292466,"width":0.15376500148399205,"height":0.015840218283913354,"page":1},{"left":0.2498328713809743,"top":0.3096590851292466,"width":0.15376500148399205,"height":0.015151515151515154,"page":1},{"left":0.40365974575865504,"top":0.3096590851292466,"width":0.005974264705882353,"height":0.015840218283913354,"page":1},{"left":0.40365974575865504,"top":0.3096590851292466,"width":0.005974264705882353,"height":0.015151515151515154,"page":1},{"left":0.4096340104645374,"top":0.3096590851292466,"width":0.04501621021943934,"height":0.015840218283913354,"page":1},{"left":0.4096340104645374,"top":0.3096590851292466,"width":0.04501621021943934,"height":0.015151515151515154,"page":1},{"left":0.04901960784313726,"top":0.3256499492760861,"width":0.1437726039512485,"height":0.015151515151515154,"page":1}]},"color":"lightcoral"},{"id":"lbub0u932cr5poqb3","text":"California employers are required to establish andimplement an Injury and Illness Prevention Program(IIPP) to protect employees from all worksite hazards,including infectious diseases.","position":{"page":1,"rects":[{"left":0.04901960784313726,"top":0.1819365472504587,"width":0.39628891290402884,"height":0.015151515151515154,"page":1},{"left":0.04901960784313726,"top":0.19791666088682236,"width":0.412422269933364,"height":0.015840218283913354,"page":1},{"left":0.04901960784313726,"top":0.19791666088682236,"width":0.412422269933364,"height":0.015151515151515154,"page":1},{"left":0.04901960784313726,"top":0.21383220210219878,"width":0.4263537837009804,"height":0.015840218283913354,"page":1},{"left":0.04901960784313726,"top":0.21383220210219878,"width":0.4263537837009804,"height":0.015151515151515154,"page":1},{"left":0.04901960784313726,"top":0.22981231573856242,"width":0.16696600820503985,"height":0.015840218283913354,"page":1},{"left":0.04901960784313726,"top":0.22981231573856242,"width":0.16696600820503985,"height":0.015151515151515154,"page":1},{"left":0.2159090827493107,"top":0.22981231573856242,"width":0.06586713603898592,"height":0.015151515151515154,"page":1}]},"color":"lightcoral"}]')
alternative_html_data = """
<html>
<body>
<h1>Alternative HTML Data</h1>
<p>Subtitle</p>
</body>
</html>
"""

app = Dash(__name__)

app.layout = html.Div([
    html.Button('Go', id='my-button'),
    HTMLAnnotator(
        id='dash-annotator',
        data=html_data,
    )
])

@app.callback(
    Output('dash-annotator', 'data'),
    Input('my-button', 'n_clicks'),
    prevent_initial_call=True
)
def go(n_clicks):
    if n_clicks % 2 == 0:
        return html_data

    return alternative_html_data

if __name__ == '__main__':
    app.run_server(debug=True)
